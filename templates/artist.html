<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{.Artist.Name}} - D√©tails</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <nav>
        <div class="nav-content">
            <a href="/" class="back-btn">‚Üê RETOUR</a>
            <h1>{{.Artist.Name}}</h1>
            <button id="theme-toggle" style="border:none; background:none; font-size:1.5rem; cursor:pointer;">üåô</button>
        </div>
    </nav>

    <main class="profile-container">
        <div class="profile-header">
            <img src="{{.Artist.Image}}" alt="{{.Artist.Name}}">
            <div class="profile-info">
                <h2>{{.Artist.Name}}</h2>
                <p><strong>Date de cr√©ation :</strong> {{.Artist.CreationDate}}</p>
                <p><strong>Premier Album :</strong> {{.Artist.FirstAlbum}}</p>
                
                <div class="members-section">
                    <h3>Membres</h3>
                    <ul class="members-list">
                        {{range .Artist.Members}}
                        <li>{{.}}</li>
                        {{end}}
                    </ul>
                </div>
            </div>
        </div>

        <div class="concerts-section">
            <h3>Dates & Lieux de Concerts</h3>
            <div class="relations-grid">
                {{range $loc, $dates := .Relation.DatesLocations}}
                <div class="relation-card">
                    <h4 class="location-title">{{$loc}}</h4>
                    <div class="dates-list">
                        {{range $dates}}
                        <span class="date-badge">{{.}}</span>
                        {{end}}
                    </div>
                </div>
                {{end}}
            </div>
        </div>

        <div class="sound-test-section">
            <h3 class="section-header">SOUND TEST</h3>
            
            <div class="player-container">
                <div class="player-screen">
                    <p class="now-playing">INITIALISATION...</p>
                    <div id="video-placeholder"></div>
                </div>
                
                <div class="player-controls">
                    <div class="btn-circle">‚óÄ</div>
                    <div class="btn-circle" style="color:red;">‚óè REC</div>
                    <div class="btn-circle">‚ñ∂</div>
                </div>

                <div id="playlist-container" class="playlist-box">
                </div>
            </div>
        </div>

        <div id="artist-data" data-name="{{.Artist.Name}}" style="display:none;"></div>

    </main>

    <script>
        var player; 

        function onYouTubeIframeAPIReady() {
            var artistName = document.getElementById("artist-data").getAttribute("data-name");
            var apiKey = "{{.ApiKey}}"; 

            fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(artistName + " top songs official")}&type=video&maxResults=5&key=${apiKey}`)
                .then(response => response.json())
                .then(data => {
                    if (data.items && data.items.length > 0) {
                        
                        var firstVideoId = data.items[0].id.videoId;
                        var firstTitle = data.items[0].snippet.title;
                        
                        document.querySelector(".now-playing").textContent = "TRACK 1: " + firstTitle;

                        player = new YT.Player('video-placeholder', {
                            height: '350',
                            width: '100%',
                            videoId: firstVideoId,
                            playerVars: { 'autoplay': 0, 'controls': 1 }
                        });

                        var playlistContainer = document.getElementById("playlist-container");
                        playlistContainer.innerHTML = ""; 

                        data.items.forEach((item, index) => {
                            var vidId = item.id.videoId;
                            var vidTitle = item.snippet.title;

                            var trackDiv = document.createElement("div");
                            trackDiv.className = "playlist-item";
                            if(index === 0) trackDiv.classList.add("active");
                            
                            trackDiv.innerHTML = `<span class="track-num">${index + 1}.</span> ${vidTitle}`;
                            
                            trackDiv.onclick = function() {
                                player.loadVideoById(vidId);
                                document.querySelector(".now-playing").textContent = "TRACK " + (index + 1) + ": " + vidTitle;
                                
                                document.querySelectorAll(".playlist-item").forEach(el => el.classList.remove("active"));
                                trackDiv.classList.add("active");
                            };

                            playlistContainer.appendChild(trackDiv);
                        });

                    } else {
                        document.querySelector(".now-playing").textContent = "AUCUN SIGNAL";
                    }
                })
                .catch(err => {
                    console.error("Erreur API", err);
                    document.querySelector(".now-playing").textContent = "ERREUR API";
                });
        }

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>

    <script src="/static/js/script.js?v=7"></script>
</body>
</html>